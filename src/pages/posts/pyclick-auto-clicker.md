---
layout: ../../layouts/PostLayout.astro
title: 自己寫一個按鍵精靈
date: 2026-01-13T15:30
description: 為了讓 Claude Code 自動同意，乾脆自己寫一個通用工具
tags:
  - Python
  - OpenCV
  - 自動化
---

最近在用 Claude Code CLI，就是 Anthropic 官方出的命令列工具，可以讓 Claude 直接幫你改 code、跑指令。

但有個問題：**每次 Claude 要執行動作都會跳確認視窗**，要你按 Yes。

一開始覺得合理，畢竟 AI 直接動你的檔案要小心。

但用久了真的很煩，尤其是讓它連續改好幾個檔案的時候，我就坐在那邊一直點 Yes Yes Yes...

## 不是有 YOLO 模式嗎

對，Claude Code 社群有人做了 [Antigravity](https://github.com/anthropics/claude-code) 之類的工具，搭配 Ralph 插件可以實現「全自動執行」的 YOLO 模式，讓 Claude 自己跑不用確認。

但我其實不想要那種。

**我只是懶得點確認，不是要讓它無人看管地跑。**

人還是在電腦前的，只是手在做別的事。

我想要的是「自動幫我按 Yes」，不是「完全放手讓 AI 自己搞」。

然後我就想：這件事本質上不就是「螢幕上出現某個按鈕 → 點它」嗎？

這種需求其實很常見。

遊戲裡的確認框、網頁上的彈窗、各種重複性的 UI 操作... 與其每次都去找專門的工具，不如寫一個通用的。

## 現有的自動點擊工具

先看看市面上有什麼：

| 工具 | 特色 | 我的看法 |
|------|------|----------|
| **按鍵精靈** | 老牌腳本工具，功能強大 | 太肥了，而且要付費 |
| **AutoHotkey** | 免費開源，社群大 | 主要是鍵盤腳本，找圖要另外裝插件 |
| **滑鼠連點器** | 簡單暴力 | 只能點固定座標，不夠聰明 |
| **Sikuli** | 基於圖像辨識 | Java 寫的，啟動慢，介面老舊 |

按鍵精靈我以前用過，確實強大，但就是太重了。

我只想要一個小工具，不想裝一整套軟體。

AutoHotkey 也研究過，腳本語法要學，找圖功能不是內建的，要另外搞 ImageSearch 之類的插件，有點麻煩。

所以我就想：**乾脆自己寫一個**。

## PyClick 的想法

核心概念很簡單：

1. 你先截一張「要找的東西」的小圖當模板
2. 程式在背景持續掃描螢幕
3. 找到匹配的圖 → 自動點擊

技術上用的是 **OpenCV 的模板匹配（Template Matching）**。

## 模板匹配是什麼

想像你有一張大圖（螢幕截圖），還有一張小圖（你要找的按鈕）。

模板匹配就是拿小圖在大圖上**一格一格滑動**，每滑到一個位置就計算「這塊區域跟小圖有多像」。

掃完整張圖之後，找出最像的那個位置，就是目標所在。

聽起來很暴力，但實際上超快。

一張 1920x1080 的螢幕截圖，配上 50x30 的小模板，用 OpenCV 跑大概只要幾毫秒。

### 怎麼算「有多像」

OpenCV 提供了好幾種比對方法，最常用的是 `TM_CCOEFF_NORMED`（正規化相關係數）。

```python
result = cv2.matchTemplate(screen, template, cv2.TM_CCOEFF_NORMED)
_, max_val, _, max_loc = cv2.minMaxLoc(result)
```

`max_val` 就是相似度，範圍是 -1 到 1：
- **1** = 完全一樣
- **0** = 完全不相關
- **-1** = 完全相反（負片的概念）

實務上設個門檻，比如 **0.7 以上就算找到**。太低會誤判，太高會漏掉。

### 其他匹配方法

| 方法 | 說明 | 特性 |
|------|------|------|
| `TM_SQDIFF` | 平方差 | 值越小越像，要找最小值 |
| `TM_CCORR` | 相關性 | 值越大越像 |
| `TM_CCOEFF` | 相關係數 | 去除亮度影響 |
| 加 `_NORMED` | 正規化版本 | 輸出範圍固定，方便設門檻 |

我選 `TM_CCOEFF_NORMED` 是因為它對**亮度變化比較不敏感**。同一個按鈕在不同視窗背景下，亮度可能有點差異，用這個方法比較穩。

### 模板匹配的限制

這方法簡單歸簡單，但有幾個限制：

- **大小要一樣** — 如果目標縮放了，就找不到。解法是準備多個不同大小的模板，或是用金字塔縮放搜尋
- **旋轉不行** — 按鈕轉個角度就 GG。不過 UI 元素通常不會旋轉，問題不大
- **半透明會影響** — 有些 UI 元素有透明度或陰影，截圖時背景不同會影響匹配

對我的需求來說，要找的都是固定大小、不會旋轉的 UI 按鈕，這些限制都不是問題。

### 為什麼不用 AI 辨識

你可能會想：現在不是流行用深度學習做圖像辨識嗎？

像是 [YOLO](https://docs.ultralytics.com/models/yolov8/)——不是 You Only Live Once 那個 YOLO，是 You Only Look Once，一個很紅的即時物件偵測模型。一張圖丟進去，它能同時偵測出裡面所有的物體並框出位置。

或是用 [CNN](https://zh.wikipedia.org/wiki/%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C)——也不是那個美國新聞台，是卷積神經網路（Convolutional Neural Network），自己訓練一個分類器。

可以，但**殺雞用牛刀**。

這些方法要準備資料集、標註圖片、訓練模型、調參數，搞半天。

模板匹配只要截一張圖就能用，而且準確度對這種場景來說已經夠了。

除非你要找的東西會變形、會縮放、長得每次都不太一樣，那才需要上 AI。

找固定的 UI 元素，模板匹配就是最務實的選擇。

## 實際用起來

做完之後拿來點 Claude Code 的確認按鈕，體驗還不錯。

把 Yes 按鈕截圖存成模板，開啟自動模式，PyClick 就會在背景監控。

一偵測到按鈕出現，嗶一聲提示，然後自動點掉。

**重點是不會干擾我做其他事。**

點完之後游標會回到原位，焦點也會還給原本的視窗。

我可以一邊讓 Claude 跑，一邊在另一個視窗打字或看文件。

後來發現其他地方也用得到：

- 遊戲裡的「領取獎勵」按鈕
- 某些軟體煩人的更新提示
- 網頁上的 Cookie 同意彈窗

基本上任何「看到就想點掉」的東西都適用。

## 還能導出 EXE

寫完之後加了一個導出功能，可以把腳本打包成獨立的 EXE。

這樣如果有特定的自動化需求，打包一個專門的小工具出來，丟給別人用也不需要裝 Python 環境。

---

其實還有蠻多東西可以聊的，像是：

- **截圖效能** — 為什麼 `pyautogui.screenshot()` 慢到不行，換成 mss 之後快了十倍
- **不搶焦點的點擊** — 用 Windows API 點完之後怎麼把游標和焦點還回去
- **系統托盤** — 怎麼讓程式縮到右下角背景跑
- **打包 EXE** — 圖片怎麼一起包進去，不用另外放檔案

這些之後再寫，這篇先到這。

沒想到自己弄了個按鍵精靈出來。

小時候玩遊戲超想要這種東西，那時候不會寫程式只能乾瞪眼。

現在居然可以自己做一個，還挺有成就感的，好像回到小朋友時期在搞這些有的沒的。

GitHub Repo: [PyClick](https://github.com/Jeffrey0117/PyClick)
